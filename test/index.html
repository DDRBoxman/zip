<!DOCTYPE html>
<html>
    <body>
        <input type="file">
        <script src="https://unpkg.com/wasm-flate@0.1.11-alpha/dist/bootstrap.js"></script>
        <!-- <script src="../dependencies/pako.js"></script> -->
        <script type="module">
            import { ZipArchive } from "../dist/zip.js";

            {
                async function compress (input) {
                    const buffer = await new Response(input).arrayBuffer();
                    const bytes = new Uint8Array(buffer);

                    const compressed_bytes = flate.deflate_encode_raw(bytes);
                    // const compressed_bytes = pako.deflateRaw(bytes);

                    return new Blob([compressed_bytes]);
                }

                async function decompress (input) {
                    const buffer = await new Response(input).arrayBuffer();
                    const bytes = new Uint8Array(buffer);

                    const decompressed_bytes = flate.deflate_decode_raw(bytes);

                    // const decompressed_bytes = pako.inflateRaw(bytes);

                    return new Blob([decompressed_bytes]);
                }

                ZipArchive.set_compression_function(compress);
                ZipArchive.set_decompression_function(decompress);
            }
            
            const file_picker = document.querySelector("input");
            file_picker.addEventListener("change", async () => {
                const file = file_picker.files[0];

                const archive = await ZipArchive.from_blob(file);

                for (const f of archive.files()) {
                    console.log(f);
                }

                const str = await archive.get("index.html").get_string();

                console.log(str);
                
                const output = await archive.to_blob();

                console.log(output);

                const result = await ZipArchive.from_blob(output);

                for (const f of result.files()) {
                    console.log(f);
                }
            });
        </script>
    </body>
</html>